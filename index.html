<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>River Rescue</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;800&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html, body {
    width: 100%; height: 100%;
    overflow: hidden;
    user-select: none;
    font-family: 'Nunito', sans-serif;
  }

  #bg {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    object-position: center;
    z-index: 0;
  }

  #scene {
    position: fixed; inset: 0;
    overflow: hidden;
    z-index: 1;
  }


  #river {
    position: absolute; left: 0; right: 0;
    overflow: hidden;
  }
  #river-canvas {
    position: absolute; inset: 0;
    width: 100%; height: 100%;
  }

  #catch-line {
    position: absolute; width: 2px;
    top: 0; bottom: 0;
    background: rgba(255,255,255,0.22);
    z-index: 5;
    box-shadow: 0 0 6px rgba(255,255,255,0.3);
  }

  .item {
    position: absolute; will-change: left;
    filter: drop-shadow(2px 3px 4px rgba(0,0,0,0.3));
    animation: floatAcross linear, bob ease-in-out infinite;
    animation-fill-mode: forwards;
    z-index: 6;
    display: flex; align-items: center; justify-content: center;
  }
  .item img {
    width: 100%; height: 100%;
    object-fit: contain;
    pointer-events: none;
  }
  @keyframes floatAcross { from { left: 105%; } to { left: -80px; } }
  @keyframes bob { 0%,100% { margin-top: 0; } 50% { margin-top: -9px; } }

  #catcher-zone {
    position: absolute; left: 38px;
    width: 80px; height: 80px;
    display: flex; align-items: center; justify-content: center;
    z-index: 10; transform: translateY(-50%); pointer-events: none;
  }
  #catcher {
    width: 72px; height: 72px;
    object-fit: contain;
    filter: drop-shadow(0 4px 10px rgba(0,0,0,0.5));
  }
  #catcher.catch-anim { animation: catchPop 0.4s ease forwards; }
  @keyframes catchPop {
    0%   { transform: scale(1); }
    40%  { transform: scale(1.65) rotate(-15deg); }
    70%  { transform: scale(0.85) rotate(10deg); }
    100% { transform: scale(1); }
  }
  #catcher.miss-anim { animation: missShake 0.35s ease forwards; }
  @keyframes missShake {
    0%,100% { transform: translateX(0); }
    25% { transform: translateX(-10px) rotate(-10deg); }
    75% { transform: translateX(10px) rotate(10deg); }
  }

  #hud {
    position: fixed; top: 0; left: 0; right: 0; z-index: 20;
    display: flex; align-items: center; justify-content: space-between;
    padding: 10px 28px;
    background: url('assets/yellow_frame.png') center/cover no-repeat;
    backdrop-filter: none;
    gap: 12px;
  }
  .hud-block { display: flex; flex-direction: column; align-items: center; min-width: 52px; }
  .hud-label { font-size: 0.6rem; letter-spacing: 2.5px; text-transform: uppercase; color: rgba(0,0,0,0.6); font-weight: 700; }
  .hud-val { font-family: 'Fredoka One', cursive; font-size: 1.8rem; line-height: 1.1; color: #000; transition: color 0.3s; }
  .hud-val.good { color: #2ecc71; }
  .hud-val.bad  { color: #e74c3c; }

  #lives-display { display: flex; align-items: center; gap: 0px; }
  #lives-display img { width: 40px; height: 40px; object-fit: contain; }
  #lives-display img.lost { filter: grayscale(1) opacity(0.35); }

  #fish-val {
    font-family: 'Fredoka One', cursive;
    font-size: 1.8rem; line-height: 1.1;
    color: #000;
  }
  #fish-val.pop { animation: fishPop 0.4s ease; }
  @keyframes fishPop {
    0%   { transform: scale(1); color: #4fc3e8; }
    40%  { transform: scale(1.5); color: #a0f0ff; }
    100% { transform: scale(1); color: #4fc3e8; }
  }

  #combo-display {
    font-family: 'Fredoka One', cursive; font-size: 1.15rem;
    color: #000; min-width: 60px; text-align: center;
  }

  #toggle-btn {
    background: none; border: 2.5px solid rgba(255,255,255,0.28);
    border-radius: 50px; padding: 8px 18px;
    display: flex; align-items: center; gap: 9px;
    cursor: pointer; color: #000;
    font-family: 'Fredoka One', cursive; font-size: 1rem;
    transition: all 0.2s cubic-bezier(0.34,1.56,0.64,1);
  }
  #toggle-btn:hover  { transform: scale(1.06); border-color: rgba(255,255,255,0.7); }
  #toggle-btn:active { transform: scale(0.94); }
  #toggle-btn.trash-mode { border-color: #e74c3c; background: rgba(231,76,60,0.15); }
  #toggle-btn.fish-mode  { border-color: #4fc3e8; background: rgba(79,195,232,0.15); }
  .mode-icon { width: 32px; height: 32px; object-fit: contain; }

  /* Hard badge shown in HUD during gameplay */
  #hard-badge {
    display: none;
    font-family: 'Fredoka One', cursive; font-size: 0.8rem;
    background: #e74c3c; color: white;
    border-radius: 50px; padding: 4px 12px;
    letter-spacing: 1px;
    animation: badgePulse 2s ease-in-out infinite;
  }
  @keyframes badgePulse {
    0%,100% { box-shadow: 0 0 8px rgba(231,76,60,0.4); }
    50%     { box-shadow: 0 0 18px rgba(231,76,60,0.9); }
  }

  .popup {
    position: absolute;
    font-family: 'Fredoka One', cursive; font-size: 1.55rem;
    pointer-events: none;
    animation: popUp 0.9s ease forwards;
    z-index: 25;
    text-shadow: 0 2px 6px rgba(0,0,0,0.5);
  }
  @keyframes popUp {
    0%   { opacity: 1; transform: translateY(0) scale(1); }
    55%  { opacity: 1; transform: translateY(-48px) scale(1.2); }
    100% { opacity: 0; transform: translateY(-80px) scale(0.85); }
  }

  .popup-img {
    position: absolute;
    display: flex; align-items: center; gap: 6px;
    pointer-events: none;
    animation: popUp 0.9s ease forwards;
    z-index: 25;
    font-family: 'Fredoka One', cursive; font-size: 1.35rem;
    text-shadow: 0 2px 6px rgba(0,0,0,0.5);
  }
  .popup-img img { width: 32px; height: 32px; object-fit: contain; }

  #overlay {
    position: fixed; inset: 0;
    background: rgba(4,12,30,0.9);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 50; gap: 14px;
  }
  #overlay h2 { font-family: 'Fredoka One', cursive; font-size: clamp(2rem,5vw,3.2rem); color: white; }
  #overlay p  { color: rgba(255,255,255,0.62); font-size: clamp(0.88rem,2vw,1.08rem); text-align: center; max-width: 400px; line-height: 1.65; }

  .overlay-btn {
    margin-top: 8px; background: #2490b5; color: white; border: none;
    border-radius: 50px; padding: 13px 42px;
    font-family: 'Fredoka One', cursive; font-size: 1.25rem;
    cursor: pointer; transition: all 0.2s cubic-bezier(0.34,1.56,0.64,1);
    box-shadow: 0 8px 24px rgba(36,144,181,0.45);
  }
  .overlay-btn:hover { transform: scale(1.08); }
  .overlay-btn.hard-btn {
    background: #c0392b;
    box-shadow: 0 8px 28px rgba(192,57,43,0.6);
  }

  #timer-display { color: #000; }
  #timer-display.urgent {
    color: #e74c3c;
    animation: timerPulse 0.6s ease-in-out infinite;
  }
  @keyframes timerPulse {
    0%,100% { transform: scale(1); }
    50%     { transform: scale(1.15); }
  }

  #hint {
    position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%);
    font-size: 0.75rem; color: rgba(0,0,0,0.6);
    font-weight: 600; letter-spacing: 0.5px;
    z-index: 15; white-space: nowrap; pointer-events: none;
  }

  #bottom-banner {
  position: fixed; bottom: 0; left: 0; right: 0;
  height: 60px; /* adjust to match your banner image height */
  background: url('assets/yellow_frame.png') center/cover no-repeat;
  z-index: 20;
}

  .intro-assets {
    display: flex; align-items: center; gap: 14px; flex-wrap: wrap; justify-content: center;
    margin: 4px 0;
  }
  .intro-assets img { width: 38px; height: 38px; object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4)); }

  /* ‚îÄ‚îÄ Hard mode toggle row ‚îÄ‚îÄ */
  #hard-row {
    display: flex; align-items: center; gap: 12px;
    cursor: pointer; padding: 8px 18px;
    border-radius: 50px;
    border: 2px solid rgba(255,255,255,0.12);
    transition: border-color 0.25s, background 0.25s;
  }
  #hard-row:hover { border-color: rgba(255,255,255,0.28); }
  #hard-row.on { border-color: #e74c3c; background: rgba(231,76,60,0.15); }

  #hard-switch {
    width: 46px; height: 24px; border-radius: 50px;
    background: rgba(255,255,255,0.12);
    border: 2px solid rgba(255,255,255,0.2);
    position: relative; flex-shrink: 0;
    transition: background 0.25s, border-color 0.25s;
  }
  #hard-row.on #hard-switch { background: #e74c3c; border-color: #e74c3c; }

  #hard-knob {
    position: absolute; top: 2px; left: 2px;
    width: 16px; height: 16px; border-radius: 50%;
    background: rgba(255,255,255,0.45);
    transition: left 0.25s, background 0.25s;
  }
  #hard-row.on #hard-knob { left: 24px; background: white; }

  #hard-text {
    font-family: 'Fredoka One', cursive; font-size: 1.05rem;
    color: rgba(255,255,255,0.4);
    transition: color 0.25s;
  }
  #hard-row.on #hard-text { color: #ff7070; }
</style>
</head>
<body>

<img src="assets/grass.png" id="bg" alt="">

<div id="scene">
  <div class="cloud cloud-a"></div>
  <div class="cloud cloud-b"></div>
  <div class="cloud cloud-c"></div>
  <div id="river">
    <canvas id="river-canvas"></canvas>
  </div>
  <div id="catch-line"></div>
  <div id="catcher-zone">
    <img id="catcher" src="assets/trashcan.png" alt="catcher">
  </div>
</div>

<div id="hud">
  <div class="hud-block">
    <span class="hud-label">Score</span>
    <span class="hud-val" id="score-display">0</span>
  </div>
  <div class="hud-block">
    <span class="hud-label">Trash Streak</span>
    <span id="combo-display">‚Äî</span>
  </div>
  <button id="toggle-btn" class="trash-mode">
    <img class="mode-icon" id="mode-icon" src="assets/trashcan.png" alt="mode">
    <span id="mode-label">Trash Can</span>
    <span style="opacity:0.45">‚áÑ</span>
  </button>
  <span id="hard-badge"> HARD</span>
  <div class="hud-block">
    <span class="hud-label">Saved</span>
    <span id="fish-val">0</span>
  </div>
  <div class="hud-block">
    <span class="hud-label">Lives</span>
    <div id="lives-display"></div>
  </div>
  <div class="hud-block">
    <span class="hud-label">Time</span>
    <span class="hud-val" id="timer-display">1:30</span>
  </div>
</div>

<div id="bottom-banner"></div>
<div id="hint">Move mouse - SPACE or click button to switch modes</div>

<div id="overlay">
  <div style="font-size:clamp(3rem,8vw,5rem)"></div>
  <h2>River Rescue</h2>
  <p>
    Move your mouse to position the catcher.<br>
    Switch between
    <strong style="color:#e74c3c">Trash Can</strong> and
    <strong style="color:#4fc3e8">Fish Net</strong> to catch the right items!<br>
    Build <strong style="color:#f1c40f">trash streaks</strong> for bonus points ‚Äî
    save as many <strong style="color:#4fc3e8">salmon</strong> as you can!<br>
    Every item that slips by costs a life.
  </p>
  <div class="intro-assets">
    <img src="assets/trashcan.png" alt="trash can">
    <img src="assets/fishing_net.png" alt="fish net">
    <img src="assets/trash2.png" alt="trash">
    <img src="assets/trash3.png" alt="trash">
    <img src="assets/trash4.png" alt="trash">
    <img src="assets/salmon.png" alt="salmon">
  </div>

  <div id="hard-row">
    <div id="hard-switch"><div id="hard-knob"></div></div>
    <span id="hard-text"> Hard Mode</span>
  </div>

  <button class="overlay-btn" id="start-btn">Start!</button>
</div>

<script>
  // ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let W, H, BANK_H, RIVER_TOP, RIVER_H, CATCH_X;

  function layout() {
    W = window.innerWidth; H = window.innerHeight;
    BANK_H    = Math.round(H * 0.27);
    RIVER_TOP = BANK_H;
    RIVER_H   = H - BANK_H * 2;
    CATCH_X   = 100;
    const riverEl = document.getElementById('river');
    riverEl.style.top    = RIVER_TOP + 'px';
    riverEl.style.height = RIVER_H + 'px';
    document.getElementById('catch-line').style.left = CATCH_X + 'px';
    riverCanvas.width  = W;
    riverCanvas.height = RIVER_H;
    if (!gameRunning) {
      catcherY = RIVER_TOP + RIVER_H / 2;
      catcherZone.style.top = catcherY + 'px';
    }
  }
  window.addEventListener('resize', layout);

  // ‚îÄ‚îÄ CANVAS RIVER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const riverCanvas = document.getElementById('river-canvas');
  const ctx = riverCanvas.getContext('2d');

  const waveBands = [
    { yFrac: 0.18, amp: 5,   freq: 0.012, speed: 0.6,  alpha: 0.13, width: 2.5 },
    { yFrac: 0.32, amp: 4,   freq: 0.018, speed: 0.9,  alpha: 0.10, width: 2   },
    { yFrac: 0.48, amp: 6,   freq: 0.010, speed: 0.5,  alpha: 0.14, width: 3   },
    { yFrac: 0.62, amp: 3.5, freq: 0.022, speed: 1.1,  alpha: 0.09, width: 1.8 },
    { yFrac: 0.76, amp: 5,   freq: 0.014, speed: 0.7,  alpha: 0.12, width: 2.5 },
  ];
  const shimmerLines = Array.from({ length: 10 }, () => ({
    xFrac: Math.random(), yFrac: 0.1 + Math.random() * 0.8,
    lenFrac: 0.05 + Math.random() * 0.12, alpha: 0.07 + Math.random() * 0.10,
    phase: Math.random() * Math.PI * 2, pulseSpeed: 0.8 + Math.random() * 1.2
  }));
  let riverTime = 0;

  function drawRiver(ts) {
    if (!RIVER_H) { requestAnimationFrame(drawRiver); return; }
    riverTime = ts * 0.001;
    const cw = riverCanvas.width, ch = riverCanvas.height;
    const grad = ctx.createLinearGradient(0, 0, 0, ch);
    grad.addColorStop(0, '#72d4f7'); grad.addColorStop(0.35, '#3aaee0');
    grad.addColorStop(0.72, '#1e8bbf'); grad.addColorStop(1, '#0e6898');
    ctx.fillStyle = grad; ctx.fillRect(0, 0, cw, ch);
    ctx.save();
    waveBands.forEach(w => {
      const y0 = w.yFrac * ch, offset = riverTime * w.speed * 60;
      ctx.beginPath();
      for (let x = 0; x <= cw; x += 3) {
        const y = y0 + Math.sin((x + offset) * w.freq) * w.amp;
        x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      }
      const wg = ctx.createLinearGradient(0, 0, cw, 0);
      wg.addColorStop(0, `rgba(255,255,255,0)`); wg.addColorStop(0.08, `rgba(255,255,255,${w.alpha})`);
      wg.addColorStop(0.92, `rgba(255,255,255,${w.alpha})`); wg.addColorStop(1, `rgba(255,255,255,0)`);
      ctx.strokeStyle = wg; ctx.lineWidth = w.width; ctx.stroke();
    });
    ctx.restore();
    ctx.save();
    shimmerLines.forEach(s => {
      const pulse = 0.5 + 0.5 * Math.sin(riverTime * s.pulseSpeed + s.phase);
      const x1 = s.xFrac * cw, y = s.yFrac * ch, len = s.lenFrac * cw;
      const sg = ctx.createLinearGradient(x1, y, x1 + len, y);
      sg.addColorStop(0, `rgba(255,255,255,0)`); sg.addColorStop(0.5, `rgba(255,255,255,${s.alpha * pulse})`);
      sg.addColorStop(1, `rgba(255,255,255,0)`);
      ctx.strokeStyle = sg; ctx.lineWidth = 1 + pulse * 2;
      ctx.beginPath(); ctx.moveTo(x1, y); ctx.lineTo(x1 + len, y); ctx.stroke();
    });
    ctx.restore();
    const topFoam = ctx.createLinearGradient(0, 0, 0, 20);
    topFoam.addColorStop(0, 'rgba(255,255,255,0.55)'); topFoam.addColorStop(1, 'rgba(255,255,255,0)');
    ctx.fillStyle = topFoam; ctx.fillRect(0, 0, cw, 20);
    const botFoam = ctx.createLinearGradient(0, ch - 20, 0, ch);
    botFoam.addColorStop(0, 'rgba(255,255,255,0)'); botFoam.addColorStop(1, 'rgba(255,255,255,0.55)');
    ctx.fillStyle = botFoam; ctx.fillRect(0, ch - 20, cw, 20);
    requestAnimationFrame(drawRiver);
  }
  requestAnimationFrame(drawRiver);

  // ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let score = 0, lives = 3, trashCombo = 0, fishCount = 0;
  let timeLeft = 90, timerInterval;
  let mode = 'trash', gameRunning = false, hardMode = false;
  let spawnInterval, diffInterval, spawnDelay, itemSpeed;
  let catcherY = 0;
  const CATCHER_HALF = 36;

  // Difficulty configs
  const CFG = {
    normal: { spawnDelay: 1800, itemSpeed: 9000, rampSpawn: 130, rampSpeed: 350, minSpawn: 550,  minSpeed: 3800 },
    hard:   { spawnDelay: 650,  itemSpeed: 4200, rampSpawn: 60,  rampSpeed: 250, minSpawn: 280,  minSpeed: 1800 }
  };

  const TRASH_ASSETS = ['assets/trash2.png', 'assets/trash3.png', 'assets/trash4.png'];
  const FISH_ASSETS  = ['assets/salmon.png'];

  const scene        = document.getElementById('scene');
  const river        = document.getElementById('river');
  const catcher      = document.getElementById('catcher');
  const catcherZone  = document.getElementById('catcher-zone');
  const toggleBtn    = document.getElementById('toggle-btn');
  const modeIcon     = document.getElementById('mode-icon');
  const modeLabel    = document.getElementById('mode-label');
  const scoreDisplay = document.getElementById('score-display');
  const livesDisplay = document.getElementById('lives-display');
  const comboDisplay = document.getElementById('combo-display');
  const fishVal      = document.getElementById('fish-val');
  const timerDisplay = document.getElementById('timer-display');
  const overlay      = document.getElementById('overlay');
  const hardRow      = document.getElementById('hard-row');
  const hardBadge    = document.getElementById('hard-badge');
  const startBtn     = document.getElementById('start-btn');

  layout();

  // ‚îÄ‚îÄ HARD MODE TOGGLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  hardRow.addEventListener('click', () => {
    hardMode = !hardMode;
    hardRow.classList.toggle('on', hardMode);
    startBtn.classList.toggle('hard-btn', hardMode);
    startBtn.textContent = hardMode ? ' Start Hard!' : 'Start!';
  });

  // ‚îÄ‚îÄ MOUSE / TOUCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.addEventListener('mousemove', (e) => {
    if (!gameRunning) return;
    catcherY = Math.max(RIVER_TOP, Math.min(RIVER_TOP + RIVER_H, e.clientY));
    catcherZone.style.top = catcherY + 'px';
  });
  document.addEventListener('touchmove', (e) => {
    if (!gameRunning) return;
    e.preventDefault();
    catcherY = Math.max(RIVER_TOP, Math.min(RIVER_TOP + RIVER_H, e.touches[0].clientY));
    catcherZone.style.top = catcherY + 'px';
  }, { passive: false });

  // ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function updateTimer() {
    const m = Math.floor(timeLeft / 60), s = timeLeft % 60;
    timerDisplay.textContent = `${m}:${s.toString().padStart(2, '0')}`;
    timerDisplay.classList.toggle('urgent', timeLeft <= 10);
  }
  function tickTimer() { timeLeft--; updateTimer(); if (timeLeft <= 0) endGame(true); }

  function updateLives() {
    livesDisplay.innerHTML = '';
    for (let i = 0; i < 3; i++) {
      const img = document.createElement('img');
      img.src = 'assets/lives.png';
      if (i >= lives) img.classList.add('lost');
      livesDisplay.appendChild(img);
    }
  }
  function updateScore(delta) {
    scoreDisplay.textContent = score;
    scoreDisplay.className = 'hud-val' + (delta > 0 ? ' good' : delta < 0 ? ' bad' : '');
    setTimeout(() => scoreDisplay.className = 'hud-val', 400);
  }
  function updateTrashCombo() {
    comboDisplay.textContent = trashCombo >= 3 ? `üî• x${trashCombo}` : trashCombo > 0 ? `‚ú® x${trashCombo}` : '‚Äî';
  }
  function updateFishCount() {
    fishVal.textContent = fishCount;
    fishVal.classList.remove('pop'); void fishVal.offsetWidth; fishVal.classList.add('pop');
    setTimeout(() => fishVal.classList.remove('pop'), 400);
  }
  function popup(text, color, x, y) {
    const p = document.createElement('div');
    p.className = 'popup';
    p.style.cssText = `color:${color};left:${x}px;top:${y}px`;
    p.textContent = text;
    scene.appendChild(p);
    setTimeout(() => p.remove(), 900);
  }
  function popupImg(imgSrc, text, color, x, y) {
    const p = document.createElement('div');
    p.className = 'popup-img';
    p.style.cssText = `color:${color};left:${x - 20}px;top:${y}px`;
    const img = document.createElement('img'); img.src = imgSrc;
    const span = document.createElement('span'); span.textContent = text;
    p.appendChild(img); p.appendChild(span);
    scene.appendChild(p);
    setTimeout(() => p.remove(), 900);
  }
  function setMode(m) {
    mode = m;
    const t = m === 'trash';
    catcher.src = t ? 'assets/trashcan.png' : 'assets/fishing_net.png';
    toggleBtn.className = t ? 'trash-mode' : 'fish-mode';
    modeIcon.src = t ? 'assets/trashcan.png' : 'assets/fishing_net.png';
    modeLabel.textContent = t ? 'Trash Can' : 'Fish Net';
  }
  function toggleMode() { setMode(mode === 'trash' ? 'fish' : 'trash'); }

  // ‚îÄ‚îÄ SPAWN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function spawnItem() {
    if (!gameRunning) return;
    const isTrash = Math.random() > 0.45;
    const assets = isTrash ? TRASH_ASSETS : FISH_ASSETS;
    const src = assets[Math.floor(Math.random() * assets.length)];
    const type = isTrash ? 'trash' : 'fish';

    const el = document.createElement('div');
    el.className = 'item';
    const sz = Math.max(36, Math.min(100, Math.round(W * 0.08)));
    el.style.width = sz + 'px'; el.style.height = sz + 'px';

    const img = document.createElement('img');
    img.src = src; img.alt = type;
    el.appendChild(img);

    const margin = 24;
    const itemRiverY = margin + Math.random() * (RIVER_H - margin * 2);
    el.style.top = itemRiverY + 'px';
    const itemSceneY = RIVER_TOP + itemRiverY + sz * 0.5;

    const dur = itemSpeed + Math.random() * 2500;
    const bob = 1.4 + Math.random() * 1.2;
    el.style.animationDuration = `${dur}ms, ${bob}s`;
    river.appendChild(el);

    const check = setInterval(() => {
      if (!gameRunning) { clearInterval(check); el.remove(); return; }
      const rect = el.getBoundingClientRect();
      const itemX = rect.left + rect.width / 2;

      if (itemX < CATCH_X + 20 && itemX > CATCH_X - 30) {
        clearInterval(check);
        const inRange    = Math.abs(catcherY - itemSceneY) < CATCHER_HALF + 24;
        const caught     = inRange && ((type === 'trash' && mode === 'trash') || (type === 'fish' && mode === 'fish'));
        const wrongCatch = inRange && !caught;
        el.remove();

        if (caught) {
          if (type === 'trash') {
            trashCombo++;
            const pts = 10 * (trashCombo >= 3 ? 2 : 1);
            score += pts; updateScore(pts); updateTrashCombo();
            popupImg(src, trashCombo >= 3 ? `+${pts} üî•` : `+${pts}`, '#f39c12', CATCH_X, catcherY - 40);
          } else {
            fishCount++; trashCombo = 0; score += 10;
            updateScore(10); updateFishCount(); updateTrashCombo();
            popupImg(src, '+1', '#4fc3e8', CATCH_X, catcherY - 40);
          }
          catcher.classList.remove('miss-anim'); void catcher.offsetWidth; catcher.classList.add('catch-anim');
          setTimeout(() => catcher.classList.remove('catch-anim'), 400);
        } else {
          trashCombo = 0; lives--;
          updateScore(-1); updateLives(); updateTrashCombo();
          catcher.classList.remove('catch-anim'); void catcher.offsetWidth; catcher.classList.add('miss-anim');
          setTimeout(() => catcher.classList.remove('miss-anim'), 400);
          popup(wrongCatch ? '‚úñ WRONG!' : '‚úñ MISSED!', '#e74c3c', CATCH_X, itemSceneY - 30);
          if (lives <= 0) endGame();
        }
      } else if (itemX < -80) {
        clearInterval(check); el.remove();
      }
    }, 40);
  }

  // ‚îÄ‚îÄ DIFFICULTY RAMP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function rampUp() {
    const cfg = hardMode ? CFG.hard : CFG.normal;
    spawnDelay = Math.max(cfg.minSpawn, spawnDelay - cfg.rampSpawn);
    itemSpeed  = Math.max(cfg.minSpeed, itemSpeed  - cfg.rampSpeed);
    clearInterval(spawnInterval);
    spawnInterval = setInterval(spawnItem, spawnDelay);
  }

  // ‚îÄ‚îÄ GAME FLOW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function startGame() {
    score = 0; lives = 3; trashCombo = 0; fishCount = 0; timeLeft = 90;
    const cfg = hardMode ? CFG.hard : CFG.normal;
    spawnDelay = cfg.spawnDelay;
    itemSpeed  = cfg.itemSpeed;
    gameRunning = true;
    layout(); setMode('trash');
    updateScore(0); updateLives(); updateTrashCombo(); updateTimer();
    fishVal.textContent = '0';
    hardBadge.style.display = hardMode ? 'inline-block' : 'none';
    overlay.style.display = 'none';
    document.querySelectorAll('.item').forEach(i => i.remove());
    spawnInterval = setInterval(spawnItem, spawnDelay);
    diffInterval  = setInterval(rampUp, 8000);
    timerInterval = setInterval(tickTimer, 1000);
    spawnItem();
  }

  function endGame(timeUp = false) {
    gameRunning = false;
    clearInterval(spawnInterval); clearInterval(diffInterval); clearInterval(timerInterval);
    timerDisplay.classList.remove('urgent');
    document.querySelectorAll('.item').forEach(i => i.remove());
    overlay.innerHTML = `
      <div style="font-size:clamp(3rem,8vw,5rem)">${timeUp ? '‚è∞' : ''}</div>
      <h2>${timeUp ? "Time's Up!" : 'Game Over!'}</h2>
      <p>
        ${hardMode ? '<span style="color:#ff7070;font-family:\'Fredoka One\',cursive;font-size:1.1em"> Hard Mode</span><br>' : ''}
        Score: <strong style="color:#f1c40f;font-size:1.3em">${score}</strong><br>
        Salmon saved: <strong style="color:#4fc3e8;font-size:1.3em">${fishCount}</strong>
        <img src="assets/salmon.png" style="width:28px;height:28px;object-fit:contain;vertical-align:middle;margin-left:4px"><br>
        <span style="color:rgba(255,255,255,0.5);font-size:0.9em">${timeUp ? 'The river is cleaner already! ' : ''}</span>
      </p>
      <button class="overlay-btn ${hardMode ? 'hard-btn' : ''}" id="restart-btn">Play Again!</button>
    `;
    overlay.style.display = 'flex';
    document.getElementById('restart-btn').addEventListener('click', startGame);
  }

  // ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  toggleBtn.addEventListener('click', toggleMode);
  document.addEventListener('keydown', e => {
    if (e.code === 'Space') { e.preventDefault(); if (gameRunning) toggleMode(); }
  });
  startBtn.addEventListener('click', startGame);

  updateLives();
</script>
</body>
</html>