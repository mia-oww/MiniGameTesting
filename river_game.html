<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>River Rescue</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;800&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --sky: #b8e4f9;
    --grass: #5cb85c;
    --grass-dark: #3d8b3d;
    --score-good: #2ecc71;
    --score-bad: #e74c3c;
  }

  html, body {
    width: 100%; height: 100%;
    overflow: hidden;
    user-select: none;
    font-family: 'Nunito', sans-serif;
    background: var(--sky);
  }

  #scene {
    position: fixed; inset: 0;
    background: var(--sky);
    overflow: hidden;
  }

  /* clouds */
  .cloud {
    position: absolute; background: white;
    border-radius: 50px; opacity: 0.82;
    animation: drift linear infinite;
  }
  .cloud::before, .cloud::after { content: ''; position: absolute; background: white; border-radius: 50%; }
  .cloud-a { width: 140px; height: 45px; top: 5%; animation-duration: 40s; animation-delay: -8s; }
  .cloud-a::before { width: 80px; height: 80px; top: -40px; left: 15px; }
  .cloud-a::after  { width: 60px; height: 60px; top: -28px; left: 60px; }
  .cloud-b { width: 90px; height: 28px; top: 12%; animation-duration: 30s; animation-delay: -20s; }
  .cloud-b::before { width: 50px; height: 50px; top: -26px; left: 10px; }
  .cloud-b::after  { width: 36px; height: 36px; top: -18px; left: 40px; }
  .cloud-c { width: 115px; height: 36px; top: 3%; animation-duration: 52s; animation-delay: -35s; }
  .cloud-c::before { width: 65px; height: 65px; top: -33px; left: 12px; }
  .cloud-c::after  { width: 48px; height: 48px; top: -22px; left: 50px; }
  @keyframes drift { from { left: -200px; } to { left: 110%; } }

  .bank { position: absolute; left: 0; right: 0; }
  .bank-top    { top: 0;    background: linear-gradient(to bottom, #d4f7a0, var(--grass) 55%, var(--grass-dark)); }
  .bank-bottom { bottom: 0; background: linear-gradient(to top,   #d4f7a0, var(--grass) 55%, var(--grass-dark)); }

  /* river â€” now just a container; canvas does the drawing */
  #river {
    position: absolute; left: 0; right: 0;
    overflow: hidden;
  }
  #river-canvas {
    position: absolute; inset: 0;
    width: 100%; height: 100%;
  }

  #catch-line {
    position: absolute; width: 2px;
    top: 0; bottom: 0;
    background: rgba(255,255,255,0.22);
    z-index: 5;
    box-shadow: 0 0 6px rgba(255,255,255,0.3);
  }

  .item {
    position: absolute; will-change: left;
    filter: drop-shadow(2px 3px 4px rgba(0,0,0,0.3));
    animation: floatAcross linear, bob ease-in-out infinite;
    animation-fill-mode: forwards; line-height: 1;
    z-index: 6;
  }
  @keyframes floatAcross { from { left: 105%; } to { left: -80px; } }
  @keyframes bob { 0%,100% { margin-top: 0; } 50% { margin-top: -9px; } }

  #catcher-zone {
    position: absolute; left: 38px;
    width: 72px; height: 72px;
    display: flex; align-items: center; justify-content: center;
    z-index: 10; transform: translateY(-50%); pointer-events: none;
  }
  #catcher { font-size: 3rem; filter: drop-shadow(0 4px 10px rgba(0,0,0,0.5)); }
  #catcher.catch-anim { animation: catchPop 0.4s ease forwards; }
  @keyframes catchPop {
    0%   { transform: scale(1); }
    40%  { transform: scale(1.65) rotate(-15deg); }
    70%  { transform: scale(0.85) rotate(10deg); }
    100% { transform: scale(1); }
  }
  #catcher.miss-anim { animation: missShake 0.35s ease forwards; }
  @keyframes missShake {
    0%,100% { transform: translateX(0); }
    25% { transform: translateX(-10px) rotate(-10deg); }
    75% { transform: translateX(10px) rotate(10deg); }
  }

  /* â”€â”€ HUD â”€â”€ */
  #hud {
    position: fixed; top: 0; left: 0; right: 0; z-index: 20;
    display: flex; align-items: center; justify-content: space-between;
    padding: 10px 28px;
    background: rgba(8,18,38,0.75);
    backdrop-filter: blur(10px);
    gap: 12px;
  }
  .hud-block { display: flex; flex-direction: column; align-items: center; min-width: 52px; }
  .hud-label { font-size: 0.6rem; letter-spacing: 2.5px; text-transform: uppercase; color: rgba(255,255,255,0.38); font-weight: 700; }
  .hud-val { font-family: 'Fredoka One', cursive; font-size: 1.8rem; line-height: 1.1; color: white; transition: color 0.3s; }
  .hud-val.good { color: var(--score-good); }
  .hud-val.bad  { color: var(--score-bad); }

  #lives-display { font-size: 1.3rem; line-height: 1; }

  /* fish counter special styling */
  #fish-val {
    font-family: 'Fredoka One', cursive;
    font-size: 1.8rem; line-height: 1.1;
    color: #4fc3e8;
    transition: color 0.3s, transform 0.2s;
  }
  #fish-val.pop { animation: fishPop 0.4s ease; }
  @keyframes fishPop {
    0%   { transform: scale(1); color: #4fc3e8; }
    40%  { transform: scale(1.5); color: #a0f0ff; }
    100% { transform: scale(1); color: #4fc3e8; }
  }

  /* combo */
  #combo-display {
    font-family: 'Fredoka One', cursive; font-size: 1.15rem;
    color: #f1c40f; min-width: 60px; text-align: center;
  }

  #toggle-btn {
    background: none; border: 2.5px solid rgba(255,255,255,0.28);
    border-radius: 50px; padding: 8px 18px;
    display: flex; align-items: center; gap: 9px;
    cursor: pointer; color: white;
    font-family: 'Fredoka One', cursive; font-size: 1rem;
    transition: all 0.2s cubic-bezier(0.34,1.56,0.64,1);
  }
  #toggle-btn:hover  { transform: scale(1.06); border-color: rgba(255,255,255,0.7); }
  #toggle-btn:active { transform: scale(0.94); }
  #toggle-btn.trash-mode { border-color: #e74c3c; background: rgba(231,76,60,0.15); }
  #toggle-btn.fish-mode  { border-color: #4fc3e8; background: rgba(79,195,232,0.15); }
  .mode-icon { font-size: 1.5rem; }

  .popup {
    position: absolute;
    font-family: 'Fredoka One', cursive; font-size: 1.55rem;
    pointer-events: none;
    animation: popUp 0.9s ease forwards;
    z-index: 25;
    text-shadow: 0 2px 6px rgba(0,0,0,0.5);
  }
  @keyframes popUp {
    0%   { opacity: 1; transform: translateY(0) scale(1); }
    55%  { opacity: 1; transform: translateY(-48px) scale(1.2); }
    100% { opacity: 0; transform: translateY(-80px) scale(0.85); }
  }

  #overlay {
    position: fixed; inset: 0;
    background: rgba(4,12,30,0.9);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 50; gap: 14px;
  }
  #overlay h2 { font-family: 'Fredoka One', cursive; font-size: clamp(2rem,5vw,3.2rem); color: white; }
  #overlay p  { color: rgba(255,255,255,0.62); font-size: clamp(0.88rem,2vw,1.08rem); text-align: center; max-width: 360px; line-height: 1.65; }
  .overlay-btn {
    margin-top: 8px; background: #2490b5; color: white; border: none;
    border-radius: 50px; padding: 13px 42px;
    font-family: 'Fredoka One', cursive; font-size: 1.25rem;
    cursor: pointer; transition: all 0.2s cubic-bezier(0.34,1.56,0.64,1);
    box-shadow: 0 8px 24px rgba(36,144,181,0.45);
  }
  .overlay-btn:hover { transform: scale(1.08); }

  #timer-display { color: white; }
  #timer-display.urgent {
    color: #e74c3c;
    animation: timerPulse 0.6s ease-in-out infinite;
  }
  @keyframes timerPulse {
    0%,100% { transform: scale(1); }
    50%     { transform: scale(1.15); }
  }

  #hint {
    position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
    font-size: 0.75rem; color: rgba(255,255,255,0.3);
    font-weight: 600; letter-spacing: 0.5px;
    z-index: 15; white-space: nowrap; pointer-events: none;
  }
</style>
</head>
<body>

<div id="scene">
  <div class="cloud cloud-a"></div>
  <div class="cloud cloud-b"></div>
  <div class="cloud cloud-c"></div>
  <div class="bank bank-top"></div>
  <div class="bank bank-bottom"></div>
  <div id="river">
    <canvas id="river-canvas"></canvas>
  </div>
  <div id="catch-line"></div>
  <div id="catcher-zone"><div id="catcher">ğŸ—‘ï¸</div></div>
</div>

<div id="hud">
  <div class="hud-block">
    <span class="hud-label">Score</span>
    <span class="hud-val" id="score-display">0</span>
  </div>
  <div class="hud-block">
    <span class="hud-label">Trash Streak</span>
    <span id="combo-display">â€”</span>
  </div>
  <button id="toggle-btn" class="trash-mode">
    <span class="mode-icon" id="mode-icon">ğŸ—‘ï¸</span>
    <span id="mode-label">Trash Can</span>
    <span style="opacity:0.45">â‡„</span>
  </button>
  <div class="hud-block">
    <span class="hud-label">ğŸŸ Saved</span>
    <span id="fish-val">0</span>
  </div>
  <div class="hud-block">
    <span class="hud-label">Lives</span>
    <div id="lives-display">â¤ï¸â¤ï¸â¤ï¸</div>
  </div>
  <div class="hud-block">
    <span class="hud-label">Time</span>
    <span class="hud-val" id="timer-display">1:30</span>
  </div>
</div>

<div id="hint">Move mouse â€¢ SPACE or click button to switch</div>

<div id="overlay">
  <div style="font-size:clamp(3rem,8vw,5rem)">ğŸŒŠ</div>
  <h2>River Rescue</h2>
  <p>Move your mouse to position the catcher.<br>
     Switch between <strong style="color:#e74c3c">ğŸ—‘ï¸ Trash Can</strong> and <strong style="color:#4fc3e8">ğŸª£ Fish Net</strong>.<br>
     Collect <strong style="color:#f1c40f">trash streaks</strong> for bonus points â€¢ count how many <strong style="color:#4fc3e8">ğŸŸ fish</strong> you save!<br>
     Every item that passes costs a life!</p>
  <button class="overlay-btn" id="start-btn">Play! ğŸš€</button>
</div>

<script>
  // â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let W, H, BANK_H, RIVER_TOP, RIVER_H, CATCH_X;

  function layout() {
    W = window.innerWidth;
    H = window.innerHeight;
    BANK_H    = Math.round(H * 0.27);
    RIVER_TOP = BANK_H;
    RIVER_H   = H - BANK_H * 2;
    CATCH_X   = 100;

    document.querySelector('.bank-top').style.height    = BANK_H + 'px';
    document.querySelector('.bank-bottom').style.height = BANK_H + 'px';
    const riverEl = document.getElementById('river');
    riverEl.style.top    = RIVER_TOP + 'px';
    riverEl.style.height = RIVER_H + 'px';
    document.getElementById('catch-line').style.left = CATCH_X + 'px';

    // resize canvas
    riverCanvas.width  = W;
    riverCanvas.height = RIVER_H;

    if (!gameRunning) {
      catcherY = RIVER_TOP + RIVER_H / 2;
      catcherZone.style.top = catcherY + 'px';
    }
  }
  window.addEventListener('resize', () => { layout(); });

  // â”€â”€ CANVAS RIVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const riverCanvas = document.getElementById('river-canvas');
  const ctx = riverCanvas.getContext('2d');

  // wave bands â€” each scrolls at a different speed & has its own sine shape
  const waveBands = [
    { yFrac: 0.18, amp: 5,   freq: 0.012, speed: 0.6,  alpha: 0.13, width: 2.5 },
    { yFrac: 0.32, amp: 4,   freq: 0.018, speed: 0.9,  alpha: 0.10, width: 2   },
    { yFrac: 0.48, amp: 6,   freq: 0.010, speed: 0.5,  alpha: 0.14, width: 3   },
    { yFrac: 0.62, amp: 3.5, freq: 0.022, speed: 1.1,  alpha: 0.09, width: 1.8 },
    { yFrac: 0.76, amp: 5,   freq: 0.014, speed: 0.7,  alpha: 0.12, width: 2.5 },
  ];

  // shimmer streaks that pulse in place (no raindrop movement)
  const shimmerLines = Array.from({ length: 10 }, () => ({
    xFrac: Math.random(),
    yFrac: 0.1 + Math.random() * 0.8,
    lenFrac: 0.05 + Math.random() * 0.12,
    alpha: 0.07 + Math.random() * 0.10,
    phase: Math.random() * Math.PI * 2,
    pulseSpeed: 0.8 + Math.random() * 1.2
  }));

  let riverTime = 0;

  function drawRiver(ts) {
    if (!RIVER_H) { requestAnimationFrame(drawRiver); return; }
    riverTime = ts * 0.001;
    const cw = riverCanvas.width;
    const ch = riverCanvas.height;

    // base water gradient
    const grad = ctx.createLinearGradient(0, 0, 0, ch);
    grad.addColorStop(0,    '#72d4f7');
    grad.addColorStop(0.35, '#3aaee0');
    grad.addColorStop(0.72, '#1e8bbf');
    grad.addColorStop(1,    '#0e6898');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, cw, ch);

    // scrolling sine wave lines
    ctx.save();
    waveBands.forEach(w => {
      const y0 = w.yFrac * ch;
      const offset = riverTime * w.speed * 60; // px offset scrolling rightâ†’left

      ctx.beginPath();
      for (let x = 0; x <= cw; x += 3) {
        const y = y0 + Math.sin((x + offset) * w.freq) * w.amp;
        x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      }

      // fade out near edges
      const wg = ctx.createLinearGradient(0, 0, cw, 0);
      wg.addColorStop(0,    `rgba(255,255,255,0)`);
      wg.addColorStop(0.08, `rgba(255,255,255,${w.alpha})`);
      wg.addColorStop(0.92, `rgba(255,255,255,${w.alpha})`);
      wg.addColorStop(1,    `rgba(255,255,255,0)`);
      ctx.strokeStyle = wg;
      ctx.lineWidth = w.width;
      ctx.stroke();
    });
    ctx.restore();

    // stationary shimmer glints that pulse
    ctx.save();
    shimmerLines.forEach(s => {
      const pulse = 0.5 + 0.5 * Math.sin(riverTime * s.pulseSpeed + s.phase);
      const alpha = s.alpha * pulse;
      const x1 = s.xFrac * cw;
      const y  = s.yFrac * ch;
      const len = s.lenFrac * cw;
      const sg = ctx.createLinearGradient(x1, y, x1 + len, y);
      sg.addColorStop(0,   `rgba(255,255,255,0)`);
      sg.addColorStop(0.5, `rgba(255,255,255,${alpha})`);
      sg.addColorStop(1,   `rgba(255,255,255,0)`);
      ctx.strokeStyle = sg;
      ctx.lineWidth = 1 + pulse * 2;
      ctx.beginPath();
      ctx.moveTo(x1, y);
      ctx.lineTo(x1 + len, y);
      ctx.stroke();
    });
    ctx.restore();

    // foam edge top
    const topFoam = ctx.createLinearGradient(0, 0, 0, 20);
    topFoam.addColorStop(0, 'rgba(255,255,255,0.55)');
    topFoam.addColorStop(1, 'rgba(255,255,255,0)');
    ctx.fillStyle = topFoam;
    ctx.fillRect(0, 0, cw, 20);

    // foam edge bottom
    const botFoam = ctx.createLinearGradient(0, ch - 20, 0, ch);
    botFoam.addColorStop(0, 'rgba(255,255,255,0)');
    botFoam.addColorStop(1, 'rgba(255,255,255,0.55)');
    ctx.fillStyle = botFoam;
    ctx.fillRect(0, ch - 20, cw, 20);

    requestAnimationFrame(drawRiver);
  }
  requestAnimationFrame(drawRiver);

  // â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let score = 0, lives = 3, trashCombo = 0, fishCount = 0;
  let timeLeft = 90; // 1 min 30 sec
  let timerInterval;
  let mode = 'trash';
  let gameRunning = false;
  let spawnInterval, diffInterval;
  let spawnDelay = 1800, itemSpeed = 9000;
  let catcherY = 0;
  const CATCHER_HALF = 36;

  const TRASH_EMOJIS = ['ğŸ¥¤','ğŸ§´','ğŸ§»','ğŸº','ğŸ¥«','ğŸ›¢ï¸','ğŸ‘Ÿ','ğŸ§¦','ğŸ“¦'];
  const FISH_EMOJIS  = ['ğŸŸ','ğŸ ','ğŸ¡','ğŸ¬','ğŸ¦‘','ğŸ™','ğŸ¦','ğŸ¦€'];

  const scene        = document.getElementById('scene');
  const river        = document.getElementById('river');
  const catcher      = document.getElementById('catcher');
  const catcherZone  = document.getElementById('catcher-zone');
  const toggleBtn    = document.getElementById('toggle-btn');
  const modeIcon     = document.getElementById('mode-icon');
  const modeLabel    = document.getElementById('mode-label');
  const scoreDisplay = document.getElementById('score-display');
  const livesDisplay = document.getElementById('lives-display');
  const comboDisplay = document.getElementById('combo-display');
  const fishVal      = document.getElementById('fish-val');
  const timerDisplay = document.getElementById('timer-display');
  const overlay      = document.getElementById('overlay');

  layout();

  // â”€â”€ MOUSE / TOUCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener('mousemove', (e) => {
    if (!gameRunning) return;
    catcherY = Math.max(RIVER_TOP, Math.min(RIVER_TOP + RIVER_H, e.clientY));
    catcherZone.style.top = catcherY + 'px';
  });
  document.addEventListener('touchmove', (e) => {
    if (!gameRunning) return;
    e.preventDefault();
    catcherY = Math.max(RIVER_TOP, Math.min(RIVER_TOP + RIVER_H, e.touches[0].clientY));
    catcherZone.style.top = catcherY + 'px';
  }, { passive: false });

  // â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateTimer() {
    const m = Math.floor(timeLeft / 60);
    const s = timeLeft % 60;
    timerDisplay.textContent = `${m}:${s.toString().padStart(2, '0')}`;
    if (timeLeft <= 10) {
      timerDisplay.classList.add('urgent');
    } else {
      timerDisplay.classList.remove('urgent');
    }
  }
  function tickTimer() {
    timeLeft--;
    updateTimer();
    if (timeLeft <= 0) endGame(true);
  }
  function updateLives() {
    livesDisplay.textContent = 'â¤ï¸'.repeat(Math.max(0,lives)) + 'ğŸ–¤'.repeat(Math.max(0,3-lives));
  }
  function updateScore(delta) {
    scoreDisplay.textContent = score;
    scoreDisplay.className = 'hud-val' + (delta > 0 ? ' good' : delta < 0 ? ' bad' : '');
    setTimeout(() => scoreDisplay.className = 'hud-val', 400);
  }
  function updateTrashCombo() {
    comboDisplay.textContent = trashCombo >= 3 ? `ğŸ”¥ x${trashCombo}` : trashCombo > 0 ? `âœ¨ x${trashCombo}` : 'â€”';
  }
  function updateFishCount() {
    fishVal.textContent = fishCount;
    fishVal.classList.remove('pop');
    void fishVal.offsetWidth;
    fishVal.classList.add('pop');
    setTimeout(() => fishVal.classList.remove('pop'), 400);
  }
  function popup(text, color, x, y) {
    const p = document.createElement('div');
    p.className = 'popup';
    p.style.cssText = `color:${color};left:${x}px;top:${y}px`;
    p.textContent = text;
    scene.appendChild(p);
    setTimeout(() => p.remove(), 900);
  }
  function setMode(m) {
    mode = m;
    const t = m === 'trash';
    catcher.textContent   = t ? 'ğŸ—‘ï¸' : 'ğŸª£';
    toggleBtn.className   = t ? 'trash-mode' : 'fish-mode';
    modeIcon.textContent  = t ? 'ğŸ—‘ï¸' : 'ğŸª£';
    modeLabel.textContent = t ? 'Trash Can' : 'Fish Net';
  }
  function toggleMode() { setMode(mode === 'trash' ? 'fish' : 'trash'); }

  // â”€â”€ SPAWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function spawnItem() {
    if (!gameRunning) return;
    const isTrash = Math.random() > 0.45;
    const pool = isTrash ? TRASH_EMOJIS : FISH_EMOJIS;
    const type = isTrash ? 'trash' : 'fish';
    const emoji = pool[Math.floor(Math.random() * pool.length)];

    const el = document.createElement('div');
    el.className = 'item';
    el.textContent = emoji;
    const fs = Math.max(28, Math.min(56, Math.round(W * 0.045)));
    el.style.fontSize = fs + 'px';

    const margin = 24;
    const itemRiverY = margin + Math.random() * (RIVER_H - margin * 2);
    el.style.top = itemRiverY + 'px';
    const itemSceneY = RIVER_TOP + itemRiverY + fs * 0.5;

    const dur = itemSpeed + Math.random() * 2500;
    const bob = 1.4 + Math.random() * 1.2;
    el.style.animationDuration = `${dur}ms, ${bob}s`;

    river.appendChild(el);

    const check = setInterval(() => {
      if (!gameRunning) { clearInterval(check); el.remove(); return; }
      const rect = el.getBoundingClientRect();
      const itemX = rect.left + rect.width / 2;

      if (itemX < CATCH_X + 20 && itemX > CATCH_X - 30) {
        clearInterval(check);
        const inRange    = Math.abs(catcherY - itemSceneY) < CATCHER_HALF + 24;
        const caught     = inRange && ((type === 'trash' && mode === 'trash') || (type === 'fish' && mode === 'fish'));
        const wrongCatch = inRange && !caught;
        el.remove();

        if (caught) {
          if (type === 'trash') {
            // trash: increment streak, score with multiplier
            trashCombo++;
            const pts = 10 * (trashCombo >= 3 ? 2 : 1);
            score += pts;
            updateScore(pts);
            updateTrashCombo();
            popup(trashCombo >= 3 ? `+${pts} ğŸ”¥` : `+${pts}`, '#f39c12', CATCH_X, catcherY - 30);
          } else {
            // fish: increment fish counter, flat 10 pts, reset trash combo
            fishCount++;
            trashCombo = 0;
            score += 10;
            updateScore(10);
            updateFishCount();
            updateTrashCombo();
            popup(`ğŸŸ +1`, '#4fc3e8', CATCH_X, catcherY - 30);
          }
          catcher.classList.remove('miss-anim');
          void catcher.offsetWidth;
          catcher.classList.add('catch-anim');
          setTimeout(() => catcher.classList.remove('catch-anim'), 400);
        } else {
          trashCombo = 0;
          lives--;
          updateScore(-1); updateLives(); updateTrashCombo();
          catcher.classList.remove('catch-anim');
          void catcher.offsetWidth;
          catcher.classList.add('miss-anim');
          setTimeout(() => catcher.classList.remove('miss-anim'), 400);
          popup(wrongCatch ? 'âœ– WRONG!' : 'âœ– MISSED!', '#e74c3c', CATCH_X, itemSceneY - 30);
          if (lives <= 0) endGame();
        }
      } else if (itemX < -80) {
        clearInterval(check); el.remove();
      }
    }, 40);
  }

  // â”€â”€ DIFFICULTY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function rampUp() {
    spawnDelay = Math.max(550, spawnDelay - 130);
    itemSpeed  = Math.max(3800, itemSpeed - 350);
    clearInterval(spawnInterval);
    spawnInterval = setInterval(spawnItem, spawnDelay);
  }

  // â”€â”€ GAME FLOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startGame() {
    score = 0; lives = 3; trashCombo = 0; fishCount = 0; timeLeft = 90;
    spawnDelay = 1800; itemSpeed = 9000;
    gameRunning = true;
    layout();
    setMode('trash');
    updateScore(0); updateLives(); updateTrashCombo(); updateTimer();
    fishVal.textContent = '0';
    overlay.style.display = 'none';
    document.querySelectorAll('.item').forEach(i => i.remove());
    spawnInterval = setInterval(spawnItem, spawnDelay);
    diffInterval  = setInterval(rampUp, 8000);
    timerInterval = setInterval(tickTimer, 1000);
    spawnItem();
  }

  function endGame(timeUp = false) {
    gameRunning = false;
    clearInterval(spawnInterval);
    clearInterval(diffInterval);
    clearInterval(timerInterval);
    timerDisplay.classList.remove('urgent');
    document.querySelectorAll('.item').forEach(i => i.remove());
    overlay.innerHTML = `
      <div style="font-size:clamp(3rem,8vw,5rem)">${timeUp ? 'â°' : 'ğŸ˜¢'}</div>
      <h2>${timeUp ? "Time's Up!" : 'Game Over!'}</h2>
      <p>
        Score: <strong style="color:#f1c40f;font-size:1.3em">${score}</strong><br>
        Fish saved: <strong style="color:#4fc3e8;font-size:1.3em">${fishCount} ğŸŸ</strong><br>
        ${timeUp ? '<span style="color:rgba(255,255,255,0.5);font-size:0.9em">Great run! The river is cleaner already ğŸŒŠ</span>' : '<span style="color:rgba(255,255,255,0.5);font-size:0.9em">The river thanks you! ğŸŒŠ</span>'}
      </p>
      <button class="overlay-btn" id="restart-btn">Play Again ğŸ”„</button>
    `;
    overlay.style.display = 'flex';
    document.getElementById('restart-btn').addEventListener('click', startGame);
  }

  // â”€â”€ CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  toggleBtn.addEventListener('click', toggleMode);
  document.addEventListener('keydown', e => {
    if (e.code === 'Space') { e.preventDefault(); if (gameRunning) toggleMode(); }
  });
  document.getElementById('start-btn').addEventListener('click', startGame);
</script>
</body>
</html>